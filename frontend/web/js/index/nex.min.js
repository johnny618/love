// version 1.1.0
var Nex=function(e){var t={view:"local",transition:"random",transition_speed:600,delay:7e3,autoplay:true,thumbnails:true,bullets:true,bar:true,load_bar:true};var n={display:"image",title:"",description:"",link:"",thumb:"",url:"#",alt:"",marker:false,infowindow:"",zoom:12,type:"ROADMAP",lat:"",lng:""};var r={type:"circle",filter:"none",pattern:"",background:"#ede8d2",hover:"#aac83f",color:"#000"};nex=this;nex.opt=jQuery.extend({},t,e);nex.opt.data=[];nex.opt.style=jQuery.extend({},r,e.style);for(var i=0,s=e.data.length;i<s;i++){nex.opt.data[i]=jQuery.extend({},n,e.data[i]);if(e.data[i].type=="map"){nex.opt.data[i].zoom=parseInt(e.data[i].zoom)}}nex.isLoaded=false;nex.isAutoplay=nex.opt.autoplay;nex.isThumbnails=nex.opt.thumbnails;nex.isBullets=nex.opt.bullets;nex.isBar=nex.opt.bar;nex.isLoadBar=nex.opt.load_bar;nex.isPattern=nex.opt.style.pattern.length>0?true:false;nex.isVideo=false;nex.isHTML5=false;nex.isImage=false;nex.isMap=false;nex.isLocal=nex.opt.view=="local"?true:false;nex.isTouch=!!("ontouchstart"in window);nex.startTime=null;nex.passTime=0;nex.progress=0;nex.prevSlide=0;nex.currentSlide=0;nex.size=nex.opt.data.length;nex.transitions=["fade","slideLeft","slideRight","slideTop","slideBottom","zoom","rotate","skew"];nex.vimeoEmbed="http://player.vimeo.com/video/%s?autoplay=0";nex.youtubeEmbed="http://www.youtube.com/v/%s?autoplay=0";this.setAnimoEffect();this.init();if(nex.isTouch)nex.enableTouch();nex.onKeypress()};Nex.prototype={init:function(){nex.displayLoader();if(nex.isLocal){nex.preloadMarkup();nex.preloadStyle();nex.initActive();nex.makeAppearance();jQuery(window).on("load",function(){nex.isLoaded=true;new Animo({el:jQuery("#nex .nex-animo-main").first(),duration:nex.opt.transition_speed,template:animo.Template.show});nex.startTime=new Date;_raf(nex.checkState);nex.setContentType();nex.onContentType();nex.initLoadBar()});nex.onItemClick()}},setAnimoEffect:function(){animo.Template.hide={opacity:[1,0]};animo.Template.show={opacity:[0,1]};animo.Template.slideLeftHide={opacity:[1,0],translateX:[0,-100,"%"]};animo.Template.slideLeftShow={opacity:[0,1],translateX:[-100,0,"%"]};animo.Template.slideRightHide={opacity:[1,0],translateX:[0,100,"%"]};animo.Template.slideRightShow={opacity:[0,1],translateX:[100,0,"%"]};animo.Template.slideTopShow={opacity:[0,1],translateY:[-100,0,"%"]};animo.Template.slideTopHide={opacity:[1,0],translateY:[0,-100,"%"]};animo.Template.slideBottomShow={opacity:[0,1],translateY:[100,0,"%"]};animo.Template.slideBottomHide={opacity:[1,0],translateY:[0,100,"%"]};animo.Template.zoom={opacity:[.9,1],scale:[2,1]};animo.Template.rotate={opacity:[.9,1],rotateY:[-90,0,"deg"]};animo.Template.skew={opacity:[.9,1],scale:[.5,1],skew:[[20,20],[0,0],"deg"]}},makeAppearance:function(){var e=jQuery("#nex-thumbnails li");if(e.length>0){new Animo({el:jQuery("#nex"),template:animo.Template.show},{el:e,gap:-85,duration:800,easing:"easeOutBack",template:{scale:[0,1],opacity:[0,1]}})}else{new Animo({el:jQuery("#nex"),template:animo.Template.show})}},checkState:function(){nex.passTime=new Date-nex.startTime;nex.progress=nex.passTime/nex.opt.delay;if(nex.progress>=1){if(!nex.isAutoplay)return;nex.nextSlide();nex.onChange()}_raf(nex.checkState)},onChange:function(){nex.progress=0;nex.startTime=new Date;nex.changeMain();nex.changeDetails();nex.setContentType();nex.onContentType();nex.initLoadBar();nex.initActive()},onContentType:function(){if(nex.isVideo){nex.Video.pause();nex.Video.play()}else if(nex.isMap){nex.Video.pause();nex.Map.init();nex.Map.clear()}else{nex.Video.pause()}},initLoadBar:function(){if(!nex.isLoadBar)return;if(!nex.isAutoplay)return;var e=jQuery("#nex-loadbar-progress");new Animo({el:e,duration:nex.opt.delay,template:{width:[0,100,"%"]}})},initActive:function(){nex.removeActive(jQuery("#nex-thumbnails li"));nex.removeActive(jQuery(".nex-bullet"));nex.setActive(jQuery("#nex-thumbnails li").eq(nex.currentSlide));nex.setActive(jQuery(".nex-bullet").eq(nex.currentSlide))},preloadContentType:function(){var e="";for(var t=0;t<nex.size;t++){var n=nex.opt.data[t].display;var r=t===0?"is-active":"";var i="opacity:0;";switch(n){case"image":e+="<div class='nex-animo-main "+r+"' style='"+i+"'><div class='nex-main nex-"+nex.opt.style.filter+" is-image' style='background-image:url("+nex.opt.data[t].link+")'>					"+nex.showPattern()+"</div></div>";break;case"video":var s=nex._parseVideo(nex.opt.data[t].url);if(nex.isHTML5){var o=nex._getBrowser()[0];if(o=="MSIE"){e+="<div class='nex-main nex-animo-main nex-"+nex.opt.style.filter+" is-video "+r+"' style='"+i+"'></div>"}else{e+="<div class='nex-main nex-animo-main nex-"+nex.opt.style.filter+" is-video "+r+"' style='"+i+"'>							<video src='"+s+"' type='video/mp4' width='100%' height='100%' controls preload></video></div>"}nex.isHTML5=false}else{e+="<div class='nex-main nex-animo-main nex-"+nex.opt.style.filter+" is-video "+r+"' style='"+i+"'>						<iframe style='overflow:hidden;height:100%;width:100%' src='"+s+"' width='100%' height='100%' frameborder='0' webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe></div>"}break;case"map":e+="<div class='nex-main nex-animo-main nex-"+nex.opt.style.filter+" is-map "+r+"' id='gmap-"+t+"' style='"+i+"'></div>";break;default:break}}return e},preloadMarkup:function(){var e="<div id='nex' class='nex-"+nex.opt.style.type+"'>";if(nex.isBar){e+="<div id='nex-bar'>";e+=nex.showThumbnails();e+=nex.showDetails();e+=nex.showBullets();e+="</div>"}else{e+=nex.showThumbnails();e+=nex.showBullets()}e+=nex.preloadContentType();e+=nex.showLoadBar();e+="</div>";jQuery("body").append(e)},preloadStyle:function(){var e=nex._hexToRgb(nex.opt.style.background);var t="<style type='text/css'>";t+="#nex-bar,#nex-loadbar,#nex-loadbar-progress {background-color:"+nex.opt.style.background+"}";t+="#nex-thumbnails li {border:4px solid "+nex.opt.style.background+";border:4px solid rgba("+e.r+","+e.g+","+e.b+","+.75+") }";t+="a:hover.nex-bullet, a.nex-bullet.is-active {background-color:"+nex.opt.style.hover+"}";t+="#nex-details {color:"+nex.opt.style.color+"}";if(!nex.isBar){var n=-(jQuery("#nex-thumbnails").outerWidth(true)/2);t+="#nex-thumbnails {margin-left:"+n+"px}"}if(nex.isPattern)t+="#nex-pattern {background:url("+nex.opt.style.pattern+")}";t+="</style>";jQuery("body").append(t)},displayLoader:function(){var e='<div id="nex-preloader"><div id="nex-preloader-1"></div><div id="nex-preloader-2"></div><div id="nex-preloader-3"></div><div id="nex-preloader-4"></div></div>';jQuery("body").append(e)},showLoadBar:function(){return nex.isLoadBar?"<div id='nex-loadbar'></div><div id='nex-loadbar-progress'></div>":""},showDetails:function(){return"<div id='nex-details'><span id='nex-details-title'>"+nex.getTitle()+"</span><span id='nex-details-description'> "+nex.getDescription()+"</span></div>"},showPattern:function(){return nex.isPattern?"<div id='nex-pattern'>Â </div>":""},showBullets:function(){if(!nex.isBullets)return"";var e="";e+="<div id='nex-bullets'>";for(i=0,len=nex.opt.data.length;i<len;i++){var t=nex.opt.data[i].url||"#";e+="<a href='"+t+"' class='nex-bullet' 						data-nex-title='"+nex.opt.data[i].title+"'						data-nex-description='"+nex.opt.data[i].description+"'						data-nex-display='"+nex.opt.data[i].display+"'						data-nex-link='"+nex.opt.data[i].link+"'						></a>"}e+="</div>";return e},showThumbnails:function(){if(!nex.isThumbnails)return"";var e="";e+="<ul id='nex-thumbnails'>";for(i=0,len=nex.opt.data.length;i<len;i++){switch(nex.opt.data[i].display){case"image":case"video":e+="<li data-nex-display='"+nex.opt.data[i].display+"' data-nex-title='"+nex.opt.data[i].title+"' data-nex-description='"+nex.opt.data[i].description+"'>";e+="<a href='"+nex.opt.data[i].url+"'><img class='nex-"+nex.opt.style.filter+"' src='"+nex.opt.data[i].thumb+"' alt='"+nex.opt.data[i].alt+"' width='125' height='125' /></a>";e+="</li>";break;case"map":e+="<li data-nex-display='"+nex.opt.data[i].display+"' data-nex-title='"+nex.opt.data[i].title+"' data-nex-description='"+nex.opt.data[i].description+"'>";e+="<a href='#'><img class='nex-"+nex.opt.style.filter+"' src='"+nex.opt.data[i].thumb+"' width='125' height='125' /></a>";e+="</li>";break;default:break}}e+="</ul><div class='clear'></div>";return e},setContentType:function(){contentType=nex.opt.data[nex.currentSlide].display;switch(contentType){case"video":nex.isImage=false;nex.isVideo=true;nex.isMap=false;break;case"map":nex.isImage=false;nex.isVideo=false;nex.isMap=true;break;default:nex.isImage=true;nex.isVideo=false;nex.isMap=false}},getContentType:function(){return nex.opt.data[nex.currentSlide].display},getTitle:function(){return nex.opt.data[nex.currentSlide].title},getDescription:function(){return nex.opt.data[nex.currentSlide].description},onItemClick:function(){jQuery("#nex-thumbnails li, .nex-bullet").on("click",function(){nex.goTo(jQuery(this).index());return false})},changeMain:function(){nex.execTransition()},changeDetails:function(){jQuery("#nex-details-title").text(nex.getTitle()+" ");jQuery("#nex-details-description").html(nex.getDescription())},execTransition:function(){var e=jQuery("#nex .nex-animo-main").eq(nex.prevSlide);var t=jQuery("#nex .nex-animo-main").eq(nex.currentSlide);t.addClass("is-active");e.removeClass("is-active");if(nex.opt.transition=="random"){var n=nex.transitions[nex.getRandom(0,nex.transitions.length)]}else{var n=nex.opt.transition}switch(n){case"none":t.addClass("is-active").css("opacity",1).siblings("#nex .nex-animo-main").removeClass("is-active").css("opacity",0);break;case"fade":new Animo({el:e,duration:nex.opt.transition_speed,template:animo.Template.hide},{el:t,duration:nex.opt.transition_speed,template:animo.Template.show});break;case"slideLeft":new Animo({el:e,duration:nex.opt.transition_speed,template:animo.Template.slideRightHide},{el:t,duration:nex.opt.transition_speed,template:animo.Template.slideLeftShow});break;case"slideRight":new Animo({el:e,duration:nex.opt.transition_speed,template:animo.Template.slideLeftHide},{el:t,duration:nex.opt.transition_speed,template:animo.Template.slideRightShow});break;case"slideTop":new Animo({el:e,duration:nex.opt.transition_speed,template:animo.Template.slideBottomHide},{el:t,duration:nex.opt.transition_speed,template:animo.Template.slideTopShow});break;case"slideBottom":new Animo({el:e,duration:nex.opt.transition_speed,template:animo.Template.slideTopHide},{el:t,duration:nex.opt.transition_speed,template:animo.Template.slideBottomShow});break;case"zoom":new Animo({el:e,duration:nex.opt.transition_speed,template:animo.Template.hide},{el:t,duration:nex.opt.transition_speed,template:animo.Template.zoom});break;case"rotate":new Animo({el:e,duration:nex.opt.transition_speed,template:animo.Template.hide},{el:t,duration:nex.opt.transition_speed,template:animo.Template.rotate});break;case"skew":new Animo({el:e,duration:nex.opt.transition_speed,template:animo.Template.hide},{el:t,duration:nex.opt.transition_speed,template:animo.Template.skew});break}},getRandom:function(e,t){return Math.floor(Math.random()*(t-e)+e)},setActive:function(e){e.addClass("is-active")},removeActive:function(e){e.removeClass("is-active")},goTo:function(e){nex.prevSlide=nex.currentSlide;nex.currentSlide=e;nex.onChange()},nextSlide:function(){nex.prevSlide=nex.currentSlide;nex.currentSlide++;if(nex.currentSlide==nex.size)nex.currentSlide=0;nex.onChange()},previousSlide:function(){nex.prevSlide=nex.currentSlide;nex.currentSlide--;if(nex.currentSlide<0)nex.currentSlide=nex.size-1;nex.onChange()},Video:{play:function(){if(nex.opt.autoplay)nex.isAutoplay=false;var e=jQuery(".nex-main").eq(nex.currentSlide).find("iframe");if(e.length==1){var t=e.attr("src");var t=t.slice(0,t.length-1)+1;e.attr("src",t)}else{var n=jQuery(".nex-main").eq(nex.currentSlide).find("video");if(n.length==1){n=n[0];n.play()}else{var r=jQuery(".nex-main").eq(nex.currentSlide);var i=nex.opt.data[nex.currentSlide].url;r.html('<object width="100%" height="100%"> <param name="movie" value="http://fpdownload.adobe.com/strobe/FlashMediaPlayback.swf"></param><param name="flashvars" value="src=http%3A%2F%2Fnex.riseledger.com%2Fupload%2Fslider%2Fimages%2Fexample.mp4"></param><param name="allowFullScreen" value="true"></param><param name="allowscriptaccess" value="always"></param><embed src="http://fpdownload.adobe.com/strobe/FlashMediaPlayback.swf" type="application/x-shockwave-flash" allowscriptaccess="always" allowfullscreen="true"  width="100%" height="100%" flashvars="src='+i+'&autoPlay=true"></embed></object>')}}},pause:function(){if(nex.opt.autoplay)nex.isAutoplay=true;var e=jQuery(".nex-main").eq(nex.prevSlide).find("iframe");if(e.length==1){var t=e.attr("src");var t=t.slice(0,t.length-1)+0;e.attr("src",t)}else{var n=jQuery(".nex-main").eq(nex.prevSlide).find("video");if(n.length==1){n=n[0];n.pause()}else{jQuery(".nex-main").eq(nex.prevSlide).html("")}}}},Map:{init:function(){var e=new google.maps.LatLng(nex.opt.data[nex.currentSlide].lat,nex.opt.data[nex.currentSlide].lng);var t={zoom:nex.opt.data[nex.currentSlide].zoom,center:e,mapTypeId:nex.Map.getType(nex.opt.data[nex.currentSlide].type)};var n=new google.maps.Map(document.getElementById("gmap-"+nex.currentSlide),t);nex.Map.showMarker(n,e)},showMarker:function(e,t){if(!nex.opt.data[nex.currentSlide].marker)return"";var n=new google.maps.InfoWindow({content:nex.opt.data[nex.currentSlide].infowindow});var r=new google.maps.Marker({position:t,map:e});google.maps.event.addListener(r,"click",function(){n.open(e,r)})},getType:function(e){var t=google.maps.MapTypeId.ROADMAP;e=e.toUpperCase();switch(e){case"SATELLITE":t=google.maps.MapTypeId.SATELLITE;break;case"HYBRID":t=google.maps.MapTypeId.HYBRID;break;case"TERRAIN":t=google.maps.MapTypeId.TERRAIN;break;default:t=google.maps.MapTypeId.ROADMAP;break}return t},clear:function(){jQuery(".nex-main").eq(nex.currentSlide).siblings(".is-map").html("").removeAttr("style")}},enableTouch:function(){var e={};var t={};jQuery("#nex").on("touchstart touchmove touchend",function(e){if(jQuery(e.target).hasClass("nex-main"))e.preventDefault();var n=jQuery(this);var r=n.find(".nex-animo-main.is-active");var i=nex.currentSlide==nex.size-1?jQuery(this).find(".nex-animo-main").first():r.next();var s=nex.currentSlide==0?jQuery(this).find(".nex-animo-main").eq(nex.size-1):r.prev();var o=n.width();switch(e.type){case"touchstart":var u=event.targetTouches[0];coords={x:u.pageX,y:u.pageY,time:+(new Date)};t={};break;case"touchmove":var u=event.targetTouches[0];t={x:u.pageX-coords.x,y:u.pageY-coords.y};t.x=t.x/(!nex.currentSlide&&t.x>0||nex.currentSlide==nex.size-1&&t.x<0?Math.abs(t.x)/o+1:1);var a=o+t.x;var f=-o+t.x;jQuery(r).css({"-webkit-transform":"translateX( "+t.x+"px)",transform:"translateX( "+t.x+"px)"});jQuery(i).css({opacity:1,"-webkit-transform":"translateX( "+a+"px)",transform:"translateX( "+a+"px)"});jQuery(s).css({opacity:1,"-webkit-transform":"translateX( "+f+"px)",transform:"translateX( "+f+"px)"});break;case"touchend":var l=+(new Date)-coords.time;var c=l<500&&Math.abs(t.x)>20;var h=t.x<0;if(c){if(h){var p=nex.getSwipe(r);var d=nex.getSwipe(i);if(r.length==0||i.length==0)return;nex.prevSlide=nex.currentSlide;nex.currentSlide=nex.currentSlide==nex.size-1?0:nex.currentSlide+1;nex.onChange();new Animo({el:r,duration:nex.opt.transition_speed,template:{opacity:[1,0],translateX:[p,-o,"px"]}},{el:i,duration:nex.opt.transition_speed,template:{translateX:[o+p,0,"px"]}})}else{var p=nex.getSwipe(r);var v=nex.getSwipe(s);if(r.length==0||s.length==0)return;nex.prevSlide=nex.currentSlide;nex.currentSlide=nex.currentSlide==0?nex.size-1:nex.currentSlide-1;nex.onChange();new Animo({el:r,duration:nex.opt.transition_speed,template:{opacity:[1,0],translateX:[p,o,"px"]}},{el:s,duration:nex.opt.transition_speed,template:{translateX:[v,0,"px"]}})}}else{if(h){var p=nex.getSwipe(r);var d=nex.getSwipe(i);if(r.length==0||i.length==0)return;new Animo({el:r,duration:nex.opt.transition_speed,template:{translateX:[p,0,"px"]}},{el:i,duration:nex.opt.transition_speed,template:{opacity:[1,0],translateX:[o+p,o,"px"]}})}else{var p=nex.getSwipe(r);var v=nex.getSwipe(s);if(r.length==0||s.length==0)return;new Animo({el:r,duration:nex.opt.transition_speed,template:{translateX:[p,0,"px"]}},{el:s,duration:nex.opt.transition_speed,template:{opacity:[1,0],translateX:[v,-o,"px"]}})}}break}})},getSwipe:function(e){var t=e.attr("style");var n="0";var r=/translateX\((-)?\d+/g;if(r.test(t))n=t.match(r)[0];return parseInt(n.replace("translateX(",""))},onKeypress:function(){jQuery(window).keydown(function(e){if(e.keyCode==37){nex.previousSlide()}if(e.keyCode==39){nex.nextSlide()}})},_hexToRgb:function(e){var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;e=e.replace(t,function(e,t,n,r){return t+t+n+n+r+r});var n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return n?{r:parseInt(n[1],16),g:parseInt(n[2],16),b:parseInt(n[3],16)}:null},_parseVideo:function(e){var t="";var n="";if(/youtube.com/.test(e)){t=nex._parseYoutube(e);n=nex.youtubeEmbed.replace("%s",t)}else if(/vimeo.com/.test(e)){t=nex._parseVimeo(e);n=nex.vimeoEmbed.replace("%s",t)}else{n=e;nex.isHTML5=true}return n},_parseYoutube:function(e){var t=/^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#\&\?]*).*/;var n=e.match(t);if(n&&n[7].length==11){return n[7]}},_parseVimeo:function(e){var t=e.match(/^.+vimeo.com\/(.*\/)?([^#\?]*)/);return t?t[2]||t[1]:null},_getBrowser:function(){var e=navigator.appName,t=navigator.userAgent,n;var r=t.match(/(opera|chrome|safari|firefox|msie)\/?\s*(\.?\d+(\.\d+)*)/i);if(r&&(n=t.match(/version\/([\.\d]+)/i))!=null)r[2]=n[1];r=r?[r[1],r[2]]:[e,navigator.appVersion,"-?"];return r}}